<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - Gadget Cave</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

  <div class="buy-container">
    <h2>Delivery & Payment</h2>
    <form id="addressForm">
      <input type="text" id="name" placeholder="Full Name" required />
      <input type="text" id="address" placeholder="Address Line" required />
      <input type="text" id="house" placeholder="House No (optional)" />
      <input type="text" id="landmark" placeholder="Landmark (optional)" />
      <input type="text" id="city" placeholder="City" required />
      <input type="text" id="district" placeholder="District" required />
      <input type="text" id="state" placeholder="State" required />
      <input type="text" id="pincode" placeholder="Pincode" required />
      <input type="tel" id="phone" placeholder="Phone Number" required />

      <button type="submit" class="buy-now">Continue to Pay</button>
    </form>
  </div>

  <script>
    document.getElementById("addressForm").onsubmit = e => {
      e.preventDefault();
      const p = JSON.parse(localStorage.getItem("selectedProduct"));
      if (!p) return alert("No product selected");

      const del = {};
      ["name","address","house","landmark","city","district","state","pincode","phone"].forEach(id=>{
        del[id] = document.getElementById(id).value.trim();
      });

      localStorage.setItem("deliveryInfo", JSON.stringify(del));

      // Redirect to UPI payment
      const amt = p.price.replace("â‚¹","").trim();
      const upi = "hixzam313@okaxis";
      location.href = `upi://pay?pa=${upi}&pn=GadgetCave&am=${amt}&cu=INR`;

      // After payment, show Finish button
      setTimeout(() => {
        if(confirm("Payment done? Click OK to finish order.")) {
          // Send to WhatsApp with address and product
          let msg = `ðŸ“¦ *New Order*\n`;
          msg += `Product: ${p.name} - ${p.price}\n`;
          msg += Object.entries(del).filter(([k,v])=>v).map(([k,v])=>{
            return `${k.replace(/^\w/,c=>c.toUpperCase())}: ${v}`;
          }).join("\n");
          msg += `\nâœ… Order Completed!`;
          const wa = `https://wa.me/919744340057?text=${encodeURIComponent(msg)}`;
          location.href = wa;
        } else {
          alert("Tap Finish after completing payment.");
        }
      }, 1000);
    };
  </script>

</body>
</html>
